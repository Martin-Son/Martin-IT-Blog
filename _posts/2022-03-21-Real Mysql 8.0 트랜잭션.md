---
toc: true
title: Real Mysql 8.0 [트랜잭션과 잠금]
layout: post
comments: true
date: '2022-03-21 18:00:00'
published: true
categories: [Real MySQL 8.0]
---

## 트랜잭션이란?
논리적인 작업의 가장 작은 단위로, 작업의 일관성을 보장해주기 위한 단위입니다. 이러한 특성에 의해
작업이 부분적으로 실패하거나 성공하지 않고, 완전히 성공 또는 실패하게 됩니다.

## 트랜잭션의 특성
트랜잭션에는 아래 네가지 특성이 존재하며 각 특성의 앞글자를 따서 ACID로 불립니다.
1. 원자성 (Atomicity)
- 트랜잭션이 하나의 수행단위이며, 완전히 수행(Commit) 되거나 전혀 수행되지 않아야 합니다(Rollback)
2. 일관성 (Consistency)
- 트랜잭션이 끝난 전후로 데이터베이스는 항상 일관된 상태(제약조건 만족)를 유지해야 합니다
3. 고립성 (Isolation)
- 서로 다른 트랜잭션은 독립적이며 간섭할 수 없는 상태입니다.
4. 지속성 (Durability)
- 트랜잭션이 Data를 변경시킨 뒤 Commit 되면 이후 데이터는 손실되지 않고 유지됩니다.

**트랜잭션 특성에 따른 결과 차이**
MySQL에서 사용하는 것으로 알려진 대표직인 2개의 Storage Engine이 존재하는데, InnoDB / MyISAM 엔진입니다.
위에서 설명한 트랜잭션의 특성을 따르는 InnoDB 테이블과 그렇지 않은 MyISAM 테이블 결과를 아래 테스트를 통해 비교해보겠습니다.

```sql
-- myisam 테이블 생성 
mysql> CREATE TABLE tab_myisam ( fdpk INT NOT NULL, PRIMARY KEY (fdpk) ) ENGINE=MyISAM;
Query OK, 0 rows affected (0.02 sec)
mysql> INSERT INTO tab_myisam (fdpk) VALUES (3);
Query OK, 1 row affected (0.01 sec)

-- innodb 테이블 생성 
mysql> CREATE TABLE tab_innodb ( fdpk INT NOT NULL, PRIMARY KEY (fdpk) ) ENGINE=InnoDB;
Query OK, 0 rows affected (0.03 sec)
mysql> INSERT INTO tab_innodb (fdpk) VALUES (3);
Query OK, 1 row affected (0.01 sec)

-- PK 중복 에러가 발생하도록, (1,2,3) Insert
mysql> INSERT INTO tab_myisam (fdpk) VALUES (1), (2), (3);
ERROR 1062 (23000): Duplicate entry '3' for key 'tab_myisam.PRIMARY'
mysql> INSERT INTO tab_innodb (fdpk) VALUES (1), (2), (3);
ERROR 1062 (23000): Duplicate entry '3' for key 'tab_innodb.PRIMARY'

-- Insert 작업 실패 후, 테이블 데이터 확인
mysql> SELECT * FROM tab_myisam;
+------+
| fdpk |
+------+
|    1 |
|    2 |
|    3 |
+------+
3 rows in set (0.00 sec)

mysql> SELECT * FROM tab_innodb;
+------+
| fdpk |
+------+
|    3 |
+------+
1 row in set (0.01 sec)
```
